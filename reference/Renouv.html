<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit a 'Renouvellement' model — Renouv • Renext</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a 'Renouvellement' model — Renouv"><meta name="description" content="

Fit a 'renouvellement' POT model using Over the Threshold data and
  possibly historical data of two kinds."><meta property="og:description" content="

Fit a 'renouvellement' POT model using Over the Threshold data and
  possibly historical data of two kinds."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Renext</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.1-5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/IRSN/Renext/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit a 'Renouvellement' model</h1>

      <div class="d-none name"><code>Renouv.Rd</code></div>
    </div>

    <div class="ref-description section level2">


<p>Fit a 'renouvellement' POT model using Over the Threshold data and
  possibly historical data of two kinds.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Renouv</span><span class="op">(</span><span class="va">x</span>,</span>
<span>       threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       effDuration <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       distname.y <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>       MAX.data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       MAX.effDuration <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       OTS.data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       OTS.effDuration <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       OTS.threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       fixed.par.y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       start.par.y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       force.start.H <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       numDeriv <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       trans.y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       jitter.KS <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       pct.conf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">95</span>, <span class="fl">70</span><span class="op">)</span>,</span>
<span>       rl.prob <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       prob.max <span class="op">=</span> <span class="fl">1.0</span><span class="op">-</span><span class="fl">1e-04</span> ,</span>
<span>       pred.period <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       suspend.warnings <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">300</span>, fnscale <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>       control.H <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">300</span>, fnscale <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>       trace <span class="op">=</span> <span class="fl">0</span>,</span>
<span>       plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       label <span class="op">=</span> <span class="st">""</span>,</span>
<span>       <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<p></p>
<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd>

<p>Can be a numeric vector, an object of the class <code>"Rendata"</code> or
    <code>NULL</code>.  In the first case, <code>x</code> contains all the levels
    above the threshold for a variable of interest.  In the second case,
    most formal arguments take values in accordance with the object
    content, and can be by-passed by giving the formal explicitly.  When
    <code>x</code> is <code>NULL</code>, the model is fitted using the data provided
    using the <code>OTS</code> and <code>MAX</code> formals.</p>
<p></p></dd>


  <dt id="arg-threshold">threshold<a class="anchor" aria-label="anchor" href="#arg-threshold"></a></dt>
<dd>

<p>Value of the threshold for the OT data.</p>
<p></p></dd>


  <dt id="arg-effduration">effDuration<a class="anchor" aria-label="anchor" href="#arg-effduration"></a></dt>
<dd>

<p>Effective duration, i.e. duration of the OT period.</p>
<p></p></dd>

  <dt id="arg-distname-y">distname.y<a class="anchor" aria-label="anchor" href="#arg-distname-y"></a></dt>
<dd>

<p>Name of the distribution for the excesses over the threshold. See
    <b>Details</b> below.</p>
<p></p></dd>

  <dt id="arg-max-data">MAX.data<a class="anchor" aria-label="anchor" href="#arg-max-data"></a></dt>
<dd>

<p>Either a numeric vector or a list of numeric vectors representing
    historical data \(r\)-max by blocks. When <em>a vector</em> is
    given, there is only one block, and the data are the corresponding
    \(r\)-max observed levels where \(r\) is the vector
    length; the block duration is given in <code>MAX.effDuration</code>. When
    <em>a list</em> is given, each list element contains the data for one
    block, and the effective duration are in <code>MAX.effDuration</code></p>
<p></p></dd>

  <dt id="arg-max-effduration">MAX.effDuration<a class="anchor" aria-label="anchor" href="#arg-max-effduration"></a></dt>
<dd>

<p>Vector of (effective) durations, one by block MAX data.</p>
<p></p></dd>

  <dt id="arg-ots-data">OTS.data<a class="anchor" aria-label="anchor" href="#arg-ots-data"></a></dt>
<dd>

<p>A numeric vector or a list of numeric vectors representing
    supplementary Over Threshold data in blocks. When a <em>vector</em> is
    given, there is only one block, and the data contain all the
    'historical' levels over the corresponding threshold given in
    <code>OTS.threshold</code>. The block duration is given in
    <code>OTS.effDuration</code>. When a <em>list</em> is given, each list
    element contains the data for one block, and the threshold and
    effective duration are in <code>OTS.threshold</code> and
    <code>OTS.effDuration</code>.</p>
<p></p></dd>

  <dt id="arg-ots-effduration">OTS.effDuration<a class="anchor" aria-label="anchor" href="#arg-ots-effduration"></a></dt>
<dd>

<p>A numeric vector giving the (effective) durations for the OTS
    blocks.</p>
<p></p></dd>

  <dt id="arg-ots-threshold">OTS.threshold<a class="anchor" aria-label="anchor" href="#arg-ots-threshold"></a></dt>
<dd>

<p>A vector giving the thresholds for the different OTS blocks. The
    given values must be greater than or equal to the value of
    <code>threshold</code>.</p>
<p></p></dd>

  <dt id="arg-fixed-par-y">fixed.par.y<a class="anchor" aria-label="anchor" href="#arg-fixed-par-y"></a></dt>
<dd>

<p>Named list of known (or fixed) parameter values for the
    <code>y</code>-distribution.</p>
<p></p></dd>

  <dt id="arg-start-par-y">start.par.y<a class="anchor" aria-label="anchor" href="#arg-start-par-y"></a></dt>
<dd>

<p>Named list of parameter initial values for the
    <code>y</code>-distribution. Only used when the distribution does not
    belong to the list of special distributions.</p>
<p></p></dd>

  <dt id="arg-force-start-h">force.start.H<a class="anchor" aria-label="anchor" href="#arg-force-start-h"></a></dt>
<dd>

<p>Logical. When <code>TRUE</code>, the values in <code>start.par.y</code> (which
    must then be correct) will be used also as starting values in the
    maximisation of the global likelihood : OT data and historical
    data. This is useful e.g. when the historical data fall outside of
    the support for the distribution fitted without historical data. See
    below the <b>Details</b> section.</p>
<p></p></dd>

  <dt id="arg-numderiv">numDeriv<a class="anchor" aria-label="anchor" href="#arg-numderiv"></a></dt>
<dd>

<p>Logical: should the hessian be computed using the <code>numDeriv</code>
    package (value <code>TRUE</code>) or should it be taken from the results
    of <code>optim</code>?</p>
<p></p></dd>

  <dt id="arg-trans-y">trans.y<a class="anchor" aria-label="anchor" href="#arg-trans-y"></a></dt>
<dd>

<p>Transformation of the levels <em>before thresholding</em> (if not
    <code>NULL</code>).  This is only possible with the <code>"exponential"</code>
    value <code>distname.y</code>. The two allowed choices are <code>"square"</code>
    and <code>"log"</code> meaning that the fitted (exponentially distributed)
    values are <code>x.OT^2</code> <code>-threshold^2</code> and <code>log(x.OT)</code>
    <code>-log(threshold)</code> respectively.  The corresponding
    distributions for <code>x.OT</code> may be called "square-exponential" and
    "log-exponential".</p>
<p></p></dd>

  <dt id="arg-jitter-ks">jitter.KS<a class="anchor" aria-label="anchor" href="#arg-jitter-ks"></a></dt>
<dd>

<p>Logical. When set to <code>TRUE</code>, a small amount of noise is added
    to the "OT" data used in the Kolmogorov-Smirnov test in order to
    remove ties. This is done using the <code><a href="OTjitter.html">OTjitter</a></code> function.</p>
<p></p></dd>

  <dt id="arg-pct-conf">pct.conf<a class="anchor" aria-label="anchor" href="#arg-pct-conf"></a></dt>
<dd>

<p>Character or numeric vector specifying the percentages for the
    confidence (bilateral) limits on quantiles.</p>
<p></p></dd>

  <dt id="arg-rl-prob">rl.prob<a class="anchor" aria-label="anchor" href="#arg-rl-prob"></a></dt>
<dd>

<p>Vector of probabilities for the computation of return levels.  These
    are used in plots (hence must be dense enough) and appear on output
    in the data.frame <code>ret.lev</code>.</p>
<p></p></dd>

  <dt id="arg-prob-max">prob.max<a class="anchor" aria-label="anchor" href="#arg-prob-max"></a></dt>
<dd>

<p>Max value of probability for return level and confidence limits
    evaluations. This argument 'shortens' the default <code>prob</code>
    vector: values <code>&gt; prob.max</code> in the default <code>prob</code> vector
    are omitted. Ignored when a <code>prob</code> argument is given.</p>
<p></p></dd>

  <dt id="arg-pred-period">pred.period<a class="anchor" aria-label="anchor" href="#arg-pred-period"></a></dt>
<dd>

<p>A vector of "pretty" periods at which return level and probability
    will be evaluated and returned in the <code>pred</code> data.frame.</p>
<p></p></dd>

  <dt id="arg-suspend-warnings">suspend.warnings<a class="anchor" aria-label="anchor" href="#arg-suspend-warnings"></a></dt>
<dd>

<p>Logical. If <code>TRUE</code>, the warnings will be suspended during
    optimisation steps. This is useful when the parameters are subject
    to constraints as is usually the case.</p>
<p></p></dd>

  <dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd>

<p>A named list used in <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code> for the no-history stage
    (if any). Note that <code>fnscale = -1</code> says that maximisation is
    required (not minimisation) and must not be changed!</p>
<p></p></dd>

  <dt id="arg-control-h">control.H<a class="anchor" aria-label="anchor" href="#arg-control-h"></a></dt>
<dd>

<p>A named list used in <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code> for the historical stage
    (if any).</p>
<p></p></dd>

  <dt id="arg-trace">trace<a class="anchor" aria-label="anchor" href="#arg-trace"></a></dt>
<dd>

<p>Level of verbosity. Value <code>0</code> prints nothing.</p>
<p></p></dd>

  <dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd>

<p>Draw a return level plot?</p>
<p></p></dd>

  <dt id="arg-label">label<a class="anchor" aria-label="anchor" href="#arg-label"></a></dt>
<dd>

<p>Label to be used in the legend when <code>plot</code> is <code>TRUE</code>.</p>
<p></p></dd>

  </dl><p><!-- %%\item{main}{Main title for the return level plot (defaults to empty title).} -->
  <!-- %%\item{ylim}{Limits for the y axis (defaults to values computed from the data).} --></p>
<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd>

<p>Arguments passed to <code><a href="plot.Renouv.html">plot.Renouv</a></code>, e.g. <code>main</code>,
    <code>ylim</code>.</p>
<p></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>


<p>The model is fitted using Maximum Likelihood (ML).</p>
<p>Some distributions listed below and here called "special" are
  considered in a special manner.  For these distributions, it is not
  necessary to give starting values nor parameter names which are
  unambiguous.</p>
<p></p><table class="table table"><tr><td>distribution</td><td>parameters</td></tr><tr><td><!-- % -->
    <code>exponential</code></td><td><code>rate</code></td></tr><tr><td><!-- % -->
    <code>weibull</code></td><td><code>shape</code>, <code>scale</code></td></tr><tr><td><!-- % -->
    <code>GPD</code></td><td><code>scale</code>, <code>shape</code></td></tr><tr><td><!-- % -->
    <code>gpd</code></td><td><code>scale</code>, <code>shape</code></td></tr><tr><td><!-- % -->
    <code>lomax</code></td><td><code>scale</code>, <code>shape</code></td></tr><tr><td><!-- % -->
    <code>maxlo</code></td><td><code>scale</code>, <code>shape</code></td></tr><tr><td><!-- % -->
    <code>log-normal</code></td><td><code>meanlog</code>,
    <code>sdlog</code></td></tr><tr><td><!-- % -->
    <code>gamma</code></td><td><code>shape</code>, <code>scale</code></td></tr><tr><td><!-- % -->
    <code>mixexp2</code></td><td><code>prob1</code>, <code>rate1</code>, <code>delta</code></td></tr></table><p>Other distributions can be used. Because the probability functions are
  then used in a "black-box" fashion, these distributions should respect
  the following <em>formal requirements</em>:</p>
<p></p><ol><li><p>The name for the <em>density</em>, <em>distribution</em> and
    <em>quantile</em> functions must obey to the <em>classical
    "prefixing convention"</em>. Prefixes must be respectively: <code>"d"</code>,
    <code>"p"</code>, <code>"q"</code>.  This rules applies for distribution of the
    <code>stats</code> package and those of many other packages such
    <code>evd</code>.</p></li>
<li><p><em>The first (main) argument must be vectorisable</em> in all
    three functions, i.e. a vector of <code>x</code>, <code>q</code> or <code>p</code>
    must be accepted by the density, the distribution and the quantile
    functions.</p></li>
<li><p><em>The density must have a</em> <code>log</code> <em>formal</em>
    argument. When <code>log</code> is <code>TRUE</code>, the log-density is
    returned instead of the density.</p></li>
</ol><p>For such a distribution, it is necessary to give arguments names in
  <code>start.par.y</code>. The arguments list must have exactly the required
  number of parameters for the family (e.g. <code>2</code> for <code>gamma</code>).
  Some parameters can be fixed (known); then the parameter set will be
  the reunion of those appearing in <code>start.par.y</code> and those in
  <code>fixed.par.y</code>. Anyway, in the present version, <em>at least one
  parameter must be unknown</em> for the <code>y</code> part of the model.</p>
<p><em>Mathematical requirements</em> exist for a correct use of ML. They
  are referred to as "regularity conditions" in ML theory. Note that the
  support of the distribution must be the set of non-negative real
  numbers.</p>
<p>The estimation procedure differs according to the existence of
  the different types of data: main sample, MAX and OTS.</p>
<p></p><ol><li><p>When no historical data is given, the whole set of parameters
    contains orthogonal subsets: a "point process" part
    concerning the process of events, and an "observation" part
    concerning the excesses over the threshold. The parameters can in this
    case be estimated separately. The rate of the Poisson process is estimated
    by the empirical rate, i.e. the number of events divided by the total
    duration given in <code>effDuration</code>. The  "Over the Threshold"
    parameters are estimated from the excesses computed as <code>x.OT</code>
    minus the threshold.</p></li>
<li><p>When historical data is given, the two parameter vectors must be
    coped with together in maximising the global likelihood. In this case,
    we begin the estimation ignoring the historical data and then use the
    estimates as starting values for the maximisation of the global
    likelihood. In some circumstances, the estimates obtained in the first
    stage can not be used with historical data because some of these fall
    outside the support of the distribution fitted. This can happen
    e.g. with a <code>distname.y = "gpd"</code> when historical data exceed
    <code>threshold</code> - <code>scale</code>/<code>shape</code> for the values of
    <code>shape</code> and <code>scale</code> computed in the first stage.</p></li>
<li><p>From version 2.1-1 on, it is possible to use <code>OTS</code> and/or
    <code>MAX</code> data with no <code>OT</code> data by specifying <code>x =
      NULL</code>. Yet at the time this is only possible <code>distname.y</code> takes
    one of the two values: <code>"exp"</code>, or <code>"gpd"</code>.  The initial
    values for the parameter are then obtained by using the
    <code><a href="iniMAX.html">parIni.OTS</a></code>, <code><a href="iniMAX.html">parIni.MAX</a></code> functions and
    possibly by combining the two resulting initial parameter
    vectors. This possibility can be used to fit a model from <em>block
      maxima</em> or \(r\)-<em>largest</em> classical data but with more
    flexibility since the duration of the blocks may here not be constant.</p></li>
</ol><p>The returned <code>Renouv</code> object contains a <code>MAX</code> element
  concerning the distribution of block maxima in the two following
  cases.</p>
<p></p><ol><li><p>When <code>distname.y</code> is <code>"exponential"</code> or <code>"exp"</code>,
    the distribution of the maximum is Gumbel. The estimated parameters
    can be used with the <code>gumbel</code> function of the <b>evd</b> package.</p></li>
<li><p>When  <code>distname.y</code> is <code>"gpd"</code>, <code>"lomax"</code>,
    <code>"maxlo"</code> or <code>"GPD"</code>  the distribution of the maximum
    is a Generalised Extreme Values distribution. The estimated parameters
    can be used with the <code>gev</code> function of the <b>evd</b> package.</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>


<p>An object with class <code>"Renouv"</code>. This is mainly a list with the
  various results.</p>
<p></p>
<dl><dt>est.N</dt>
<dd>

<p>Estimate(s) for the count <code>"N"</code> part. This estimate
    does not use the historical data, even if is available.</p>
<p></p></dd>

  <dt>est.y</dt>
<dd>

<p>Estimate(s) for the excess <code>"y"</code> part. This estimate does
    not use the historical data, even if available.</p>
<p></p></dd>

  <dt>cov.N, cov.y</dt>
<dd>

<p>The (co-)variances for the estimates above.</p>
<p></p></dd>

  <dt>estimate</dt>
<dd>

<p>Estimate(s) for the whole set of parameters based on OT data
    <b>and on historical data</b> if available.</p>
<p></p></dd>

  <dt>ks.test</dt>
<dd>

<p>Kolmogorov-Smirnov goodness-of-fit test.</p>
<p></p></dd>

  <dt>ret.lev</dt>
<dd>

<p>A data frame containing return levels and confidence limits. The
    corresponding probabilities are either provided by user or taken as
    default values.</p>
<p></p></dd>

  <dt>pred</dt>
<dd>

<p>A data frame similar to <code>ret.lev</code>, but with "pretty" return
    periods. These are taken as the provided values <code>pred.period</code>
    if any or are chosen as "round" multiples of the time unit (taken
    from <code>effDuration</code>). The periods are chosen in order to cover
    periods ranging from 1/10 to 10 time units.</p>
<p></p></dd>

  <dt>MAX</dt>
<dd>

<p>A list providing the estimated distribution of the maximum of the
    marks over a block of unit duration. This list element only exists when
    this distribution can be deduced from the fit, which
    is the case when <code>distname.y</code> is a GPD in a broad sense,
    see <b>Details</b>.</p>
<p></p></dd>


</dl><p>Other results are available. Use <code>names(result)</code> to see their
  list.</p>
<p>Except in the the special case where <code>distname.y</code> is
  <code>"exponential"</code> and where no historical data are used, the
  inference on quantiles is obtained with the <em>delta method</em> and
  using numerical derivatives. Confidence limits are unreliable for
  return levels much greater than the observation-historical period.</p>
<p>Due to the presence of estimated parameters, the Kolmogorov-Smirnov
  test is unreliable when less than 30 observations are available.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p></p><ul><li><p>Miquel J. (1984) <em>Guide pratique d'estimation des
      probabilités de crues</em>, Eyrolles (coll. EDF DER).</p></li>
<li><p>Coles S. (2001) <em>Introduction to Statistical Modelling of Extremes
      Values</em>, Springer.</p></li>
<li><p>Embrechts P., Klüppelberg C. and Mikosch T. (1997) <em>Modelling
      Extremal Events for Insurance and Finance</em>. Springer.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>


<p>Yves Deville</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>


<p>The model only concerns the "Over the Threshold" part of the
  distribution of the observations. When historical data is used,
  observations should all be larger than the threshold.</p>
<p>The name of the elements in the returned list is indicative, and is
  likely to be changed in future versions. At the time, the effect of
  historical data on estimation (when such data exist) can be evaluated
  by comparing <code>c(res$est.N, res$est.y)</code> and <code>res$estimate</code>
  where <code>res</code> is the results list.</p>
<p>Some warnings may indicate that missing values are met during the
  optimisation process. This is due to the evaluation of the density at tail
  values. At the time the ML estimates are computed using an unconstrained
  optimisation, so invalid parameter values can be met during the
  maximisation or even be returned as (invalid) estimates.</p>
    </div>
    <div class="section level2">
    <h2 id="warning">Warning<a class="anchor" aria-label="anchor" href="#warning"></a></h2>


<p>With some distributions or in presence of historical data, the
  estimation can fail due to some problem during the optimisation. Even
  when the optimisation converges, the determination of the (numerical)
  hessian can be impossible: This can happen if <em>one or more
  parameter is too small</em> to compute a finite difference approximation
  of gradient. For instance the 'rate' parameter of the exponential
  distribution (= inverse mean) will be small when the mean of
  the excesses is large.</p>
<p>A possible solution is then to <b>rescale the data</b> e.g. dividing
  them by 10 or 100. As a rule of thumb, an acceptable scaling leads to
  data (excesses) of a few units to a few hundreds, but <b>an
  order of magnitude of thousands or more should be avoided and reduced
  by scaling</b>. The rescaling is recommended for the square exponential
  distribution (obtained with <code>trans =</code> <code>"square"</code>) since the
  observations are squared.</p>
<p>Another possible way to solve the problem is to change the
  <code>numDeriv</code> value.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">

<p><code><a href="RLplot.html">RLplot</a></code> for the <em>return level plot</em>. See
  <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code> for the tuning of the optimisation. The
  <code><a href="RenouvNoEst.html">RenouvNoEst</a></code> can be used to create an object with S3
  class <code>"Renouv"</code> from known parameters.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Garonne data. Use a "Rendata" object as 'x'. Historical data are used!</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">Renouv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Garonne</span>, distname <span class="op">=</span> <span class="st">"weibull"</span>, trace <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>              main <span class="op">=</span> <span class="st">"'Garonne' data"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> processing the 'Rendata' object 'x'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs &gt; threshold 151 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Estimate of the process rate (evt/bloc length) 2.323077 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Estimated values / covariance for the exceedances part</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       shape       scale </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1.139363 1145.889216 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             shape       scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> shape 0.005149901    1.993273</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scale 1.993272635 7470.100657</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Take into account MAX historical data of time-length 143.09 units</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Optimisation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Initial values for 2nd stage optimization</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       shape       scale </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1.139363 1145.889216 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   parscale used in 'control.H'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       75% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1 1000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ndeps used in 'control.H'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1e-06 1e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fnscale used in 'control.H'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Fixed parameters in historical optimization and hessian</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda  shape  scale </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  FALSE  FALSE  FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Maximising parameter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       shape       scale </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1.139296 1190.400483 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Maximised log-likelihood</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1196.906</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Hessian</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              [,1]         [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -29.00244229   15.5051926 -0.0130855252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  15.50519261 -410.4807227  0.2028223362</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  -0.01308553    0.2028223 -0.0002574086</span>
<span class="r-plt img"><img src="Renouv-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Main sample 'Over Threshold'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     . Threshold         2500.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     . Effect. duration    65.00 years</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     . Nb. of exceed.     151</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Estimated rate 'lambda' for Poisson process (events):  2.37 evt/year.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Distribution for exceedances y: "weibull", with 2 par. "shape", "scale" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o No transformation applied</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Coefficients</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Estimate  Std. Error  t value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda    2.370700  0.18821219 12.59589</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> shape     1.139296  0.06328141 18.00365</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scale  1190.400483 80.02387531 14.87557</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Degrees of freedom: 3 (param.) and 163 (obs)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Inference method used for return levels</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> "Delta method"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Return levels</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    period quant L.95  U.95 L.70  U.70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30     10  5773 5415  6131 5584  5963</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33     20  6395 5950  6839 6160  6629</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36     50  7195 6618  7773 6890  7501</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38    100  7789 7100  8477 7424  8153</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41    200  8373 7565  9180 7946  8800</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43    300  8710 7831  9590 8245  9175</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44    400  8949 8017  9880 8456  9441</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 46    500  9133 8160 10105 8618  9647</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 47    600  9282 8276 10289 8750  9814</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 48    700  9408 8373 10444 8861  9956</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 49    800  9518 8457 10578 8957 10078</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 51    900  9614 8531 10696 9041 10186</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 52   1000  9699 8597 10802 9116 10283</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o 'MAX' historical info: 1  blocks, 12 obs., total duration = 143.09 years</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   * block 1, 143.09 years, 12 obs.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      7500, 7400, 7000, 7000, 7000, 6600, 6500, 6500, 6400, 6300, 6300, 6200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o no 'OTS' historical data</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Kolmogorov-Smirnov test</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Asymptotic one-sample Kolmogorov-Smirnov test</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  OTjitter(y.OT, threshold = 0)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D = 0.10802, p-value = 0.05898</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: two-sided</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## generates a warning because of the ties</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu">Renouv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Garonne</span>, distname <span class="op">=</span> <span class="st">"GPD"</span>,</span></span>
<span class="r-in"><span>               jitter.KS <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>               threshold <span class="op">=</span> <span class="fl">2800</span>, trace <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>               main <span class="op">=</span> <span class="st">"'Garonne' data with threshold = 2800 and GPD fit"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> processing the 'Rendata' object 'x'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs &gt; threshold 119 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Estimate of the process rate (evt/bloc length) 1.830769 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Estimated values / covariance for the exceedances part</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        scale        shape </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1158.6426355   -0.1131778 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            scale        shape</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scale 23744.9148 -11.85919779</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> shape   -11.8592   0.00939199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Take into account MAX historical data of time-length 143.09 units</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Optimisation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Initial values for 2nd stage optimization</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        scale        shape </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1158.6426355   -0.1131778 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   parscale used in 'control.H'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  75%      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1000    1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ndeps used in 'control.H'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1e-06 1e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fnscale used in 'control.H'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Fixed parameters in historical optimization and hessian</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda  scale  shape </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  FALSE  FALSE  FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Maximising parameter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        scale        shape </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1293.7155458   -0.1613623 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Maximised log-likelihood</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -991.0444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Hessian</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              [,1]          [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -37.06678421 -0.0165187809   -33.1950619</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  -0.01651878 -0.0002367487    -0.4550967</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -33.19506190 -0.4550966706 -1062.0175205</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>ties should not be present for the one-sample Kolmogorov-Smirnov test</span>
<span class="r-plt img"><img src="Renouv-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## use a numeric vector as 'x'</span></span></span>
<span class="r-in"><span><span class="va">fit3</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>    <span class="fu">Renouv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">OTdata</span><span class="op">$</span><span class="va">Flow</span>,</span></span>
<span class="r-in"><span>           threshold <span class="op">=</span> <span class="fl">2500</span>,</span></span>
<span class="r-in"><span>           effDuration <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>           distname <span class="op">=</span> <span class="st">"GPD"</span>,</span></span>
<span class="r-in"><span>           OTS.data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6800</span>, <span class="fl">7200</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           OTS.effDuration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">150</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           OTS.threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7000</span>, <span class="fl">6000</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>           trace <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>           main <span class="op">=</span> <span class="st">"'Garonne' data with artificial \"OTS\" data"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs &gt; threshold 151 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Estimate of the process rate (evt/bloc length) 1.51 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Estimated values / covariance for the exceedances part</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       scale       shape </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1241.421464   -0.136232 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              scale        shape</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scale 19496.458520 -8.603624361</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> shape    -8.603624  0.006151174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Take into account OTS historical data on time-length 250 units </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Optimisation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o Initial values for 2nd stage optimization</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       scale       shape </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1241.421464   -0.136232 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   parscale used in 'control.H'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  75%      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1000    1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ndeps used in 'control.H'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1e-06 1e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fnscale used in 'control.H'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Fixed parameters in historical optimization and hessian</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda  scale  shape </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  FALSE  FALSE  FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Maximising parameter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        scale        shape </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1212.0996888   -0.1658686 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Maximised log-likelihood</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1170.334</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Hessian</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              [,1]          [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -69.68831050 -0.0159618171   -35.9669755</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  -0.01596182 -0.0002892484    -0.5715069</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -35.96697546 -0.5715068629 -1480.0838254</span>
<span class="r-plt img"><img src="Renouv-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">## Add historical (fictive) data</span></span></span>
<span class="r-in"><span><span class="va">fit4</span> <span class="op">&lt;-</span> <span class="fu">Renouv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">OTdata</span><span class="op">$</span><span class="va">Flow</span>,</span></span>
<span class="r-in"><span>               threshold <span class="op">=</span> <span class="fl">2500</span>,</span></span>
<span class="r-in"><span>               effDuration <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>               distname <span class="op">=</span> <span class="st">"weibull"</span>,</span></span>
<span class="r-in"><span>               fixed.par.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               OTS.data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6800</span>, <span class="fl">7200</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               OTS.effDuration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">150</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               OTS.threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7000</span>, <span class="fl">6000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               trace <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>               main <span class="op">=</span> <span class="st">"'Garonne' data with artificial \"OTS\" data"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="Renouv-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##============================================================================</span></span></span>
<span class="r-in"><span><span class="co">## use the 'venice' dataset in a r-largest fit from the 'evd' package</span></span></span>
<span class="r-in"><span><span class="co">##============================================================================</span></span></span>
<span class="r-in"><span><span class="co">## transform data: each row is a block</span></span></span>
<span class="r-in"><span><span class="va">MAX.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">venice</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## remove the NA imposed by the rectangular matrix format</span></span></span>
<span class="r-in"><span><span class="va">MAX.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">MAX.data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">MAX.effDuration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">MAX.data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## fit a Renouv model with no OT data. The threshold</span></span></span>
<span class="r-in"><span><span class="co">## must be in the support of the gev distribution</span></span></span>
<span class="r-in"><span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fl">66</span></span></span>
<span class="r-in"><span><span class="va">fit.gpd</span> <span class="op">&lt;-</span> <span class="fu">Renouv</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>                  MAX.data <span class="op">=</span> <span class="va">MAX.data</span>,</span></span>
<span class="r-in"><span>                  MAX.effDuration <span class="op">=</span> <span class="va">MAX.effDuration</span>,</span></span>
<span class="r-in"><span>                  distname.y <span class="op">=</span> <span class="st">"GPD"</span>,</span></span>
<span class="r-in"><span>                  threshold <span class="op">=</span> <span class="va">u</span>,</span></span>
<span class="r-in"><span>                  numDeriv <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                  trace <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                  plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://www.ral.ucar.edu/~ericg/softextreme.php" class="external-link">ismev</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">## compare with results from the ismev package </span></span></span>
<span class="r-in"><span>  <span class="va">fit.gev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ismev/man/rlarg.fit.html" class="external-link">rlarg.fit</a></span><span class="op">(</span><span class="va">venice</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">est.gev</span> <span class="op">&lt;-</span> <span class="va">fit.gev</span><span class="op">$</span><span class="va">mle</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est.gev</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loc"</span>, <span class="st">"scale"</span>, <span class="st">"shape"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">## transform the 'gev' fit into a Ren parameter set.</span></span></span>
<span class="r-in"><span>  <span class="va">cov.gev</span> <span class="op">&lt;-</span> <span class="va">fit.gev</span><span class="op">$</span><span class="va">cov</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cov.gev</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cov.gev</span><span class="op">)</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loc"</span>, <span class="st">"scale"</span>, <span class="st">"shape"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="gev2Ren.html">gev2Ren</a></span><span class="op">(</span><span class="va">est.gev</span>,</span></span>
<span class="r-in"><span>                   threshold <span class="op">=</span> <span class="va">u</span>,</span></span>
<span class="r-in"><span>                   vcovGev <span class="op">=</span> <span class="va">cov.gev</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>ismev <span class="op">=</span> <span class="va">trans</span>, RenextLab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit.gpd</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ismev"</span>, <span class="st">"RenextLab"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">## fill a 3d array with the two gpd covariance matrices</span></span></span>
<span class="r-in"><span>  <span class="va">cov2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">trans</span>, <span class="st">"vcov"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">## covariance</span></span></span>
<span class="r-in"><span>  <span class="va">covs</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ismev"</span>, <span class="st">"RenextLab"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">fit.gpd</span><span class="op">$</span><span class="va">cov</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">fit.gpd</span><span class="op">$</span><span class="va">cov</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="va">covs</span><span class="op">[</span><span class="st">"ismev"</span>, , <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cov2</span></span></span>
<span class="r-in"><span>  <span class="va">covs</span><span class="op">[</span><span class="st">"RenextLab"</span>, , <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit.gpd</span><span class="op">$</span><span class="va">cov</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">covs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yves Deville, Bardet, Yann Richet.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

